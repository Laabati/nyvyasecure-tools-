<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Outil Audit & Hardening | NYVYA Secure Tools</title>
  <style>
    body { font-family:sans-serif; max-width:600px; margin:auto; padding:1em }
    nav { display:flex; gap:.5em; margin-bottom:1em }
    nav button { flex:1; padding:.5em }
    section { display:none }
    section.active { display:block }
    input, textarea, button { width:100%; margin:.5em 0; padding:.5em; font-size:1em }
    pre { background:#f4f4f4; padding:1em; white-space:pre-wrap }
  </style>
</head>
<body>

  <h1>Outil Audit & Hardening</h1>

  <nav>
    <button data-tab="audit">1 â€“ Audit</button>
    <button data-tab="blocage">2 â€“ Blocage</button>
    <button data-tab="verrous">3 â€“ Verrous</button>
  </nav>

  <!-- 1. Audit -->
  <section id="audit" class="active">
    <h2>1 â€“ Analyse de fuite</h2>
    <input id="domain" placeholder="exemple.com">
    <button id="runAudit">Lancer lâ€™analyse</button>
    <pre id="resAudit">RÃ©sultats iciâ€¦</pre>
  </section>

  <!-- 2. Blocage -->
  <section id="blocage">
    <h2>2 â€“ Blocage de la fuite</h2>
    <p>Remplace les valeurs exemple puis exÃ©cute ces commandes sur ton serveur via SSH :</p>
    <textarea rows="8">
// Invalider toutes les sessions actives
ssh user@serveur.exemple.com << 'EOF'
rm -rf /var/lib/php/sessions/*
sed -i 's/session.cookie_secure = .*/session.cookie_secure = 1/' /etc/php.ini
sed -i 's/session.cookie_httponly = .*/session.cookie_httponly = 1/' /etc/php.ini
EOF
    </textarea>
  </section>

  <!-- 3. Verrous -->
  <section id="verrous">
    <h2>3 â€“ Mise en place des verrous</h2>
    <p>Remplace les chemins et directives exemple puis applique :</p>
    <textarea rows="8">
// Ajouter headers de sÃ©curitÃ© dans Nginx
ssh user@serveur.exemple.com << 'EOF'
cat >> /etc/nginx/conf.d/secure.conf << 'NGINX'
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-Frame-Options "DENY" always;
NGINX
nginx -s reload
EOF
    </textarea>
  </section>

<script>
  // Gestion des onglets
  document.querySelectorAll('nav button').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(btn.dataset.tab).classList.add('active');
    });
  });

  // Module Audit
  document.getElementById('runAudit').addEventListener('click', async () => {
    const domain = document.getElementById('domain').value.trim();
    if (!domain) return alert('Merci de saisir un domaine.');
    const out = document.getElementById('resAudit');
    out.textContent = 'â³ Analyse en coursâ€¦';

    try {
      const proxyUrl = 'https://rapid-lab-ca91.nyvya-contact.workers.dev/?target=';
      const res = await fetch(proxyUrl + encodeURIComponent(domain));
      if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);

      const json = await res.json();
      out.textContent =
`ğŸ” Domaine : ${json.target}

â­ HTTP status : ${json.status}
ğŸª Set-Cookie : ${json['set-cookie']}
ğŸ”’ HSTS : ${json['strict-transport-security']}`;
    } catch (e) {
      out.textContent = 'âŒ Erreur : ' + e.message;
      console.error(e);
    }
  });
</script>
</body>
</html>
